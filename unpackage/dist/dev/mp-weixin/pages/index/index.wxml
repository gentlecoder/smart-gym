<wxs module="cosmosMod">
var startY = 0;
var startX = 0;
var top = 0;
var code = 0;
var mit = 0;

function touchstart(event, ins) {
	top = 0;
	if (code == 0) {
		mit = 0;
		ins.callMethod('cosmosTrigger', 2);
		var touch = event.touches[0] || event.changedTouches[0]
		startY = touch.pageY
		startX = touch.pageX
	}
}

function end(newValue, oldValue, ownerInstance, instance) {
	console.log('cosmos-refresh-container end')
	ownerInstance.selectComponent('#cosmos-refresh-container').setStyle({
		'transform': 'translateY(0)',
		'transition': 'ease 0.3s'
	})
	ownerInstance.selectComponent('#load-text').removeClass('anim-text-infinite')

	ownerInstance.selectComponent('#load-text').setStyle({
		'transform': 'scale(0)'
	})

	code = 0
}

function touchend(event, ins) {
	if (code == 0) {
		if (top < 140) {
			ins.selectComponent('#cosmos-refresh-container').setStyle({
				'transform': 'translateY(0)',
				'transition': 'ease 0.3s'
			})

			ins.selectComponent('#load-text').setStyle({
				'transform': 'scale(0)'
			})
		} else {
			ins.selectComponent('#load-text').setStyle({
				'transform': 'scale(1)'
			})
			ins.callMethod('cosmosTrigger', 1);
			code = 1
			ins.selectComponent('#cosmos-refresh-container').setStyle({
				'transform': 'translateY(60px)',
				'transition': 'ease 0.3s',
				'padding-bottom': '60px',
			})
			ins.selectComponent('#load-text').addClass('anim-text-infinite')

		}
	} else {

	}


}

function touchmove(event, ins) {
	if (code == 0) {
		var touch = event.touches[0] || event.changedTouches[0]
		var pageY = touch.pageY
		var pageX = touch.pageX
		var vew = ins.selectComponent('#cosmos-refresh-container')
		var dataset = vew.getDataset();
		top = pageY - startY
		var lr = pageX - startX
		if (dataset.top == 0) {
			if (top > 140) {
				if (mit == 0) {
					ins.callMethod('cosmosTrigger', 0);
				}
				mit = 1
			}
			vew.setStyle({
				'transform': 'translateY(' + (top) + 'px)',
				'padding-bottom': top + 'px',
			})
			ins.selectComponent('#load-text').setStyle({
				'transform': 'scale(' + (top > 100 ? 1 : top / 100) + ')'
			})
		} else {
			startY = pageY
		}
	}
}
module.exports = {
	end: end,
	touchend: touchend,
	touchstart: touchstart,
	touchmove: touchmove,
}
</wxs>
<view class="index-content data-v-57280228"><view class="index-content-header data-v-57280228"><u-input class="select-region-input data-v-57280228" vue-id="8dd740cc-1" type="select" border="{{true}}" value="{{region}}" data-event-opts="{{[['^click',[['e0']]],['^input',[['__set_model',['','region','$event',[]]]]]]}}" bind:click="__e" bind:input="__e" bind:__l="__l"></u-input><u-picker vue-id="8dd740cc-2" mode="region" value="{{showRegionSelect}}" data-event-opts="{{[['^confirm',[['handleSelectRegion']]],['^input',[['__set_model',['','showRegionSelect','$event',[]]]]]]}}" bind:confirm="__e" bind:input="__e" class="data-v-57280228" bind:__l="__l"></u-picker><u-search vue-id="8dd740cc-3" show-action="{{true}}" action-text="搜索" animation="{{true}}" class="data-v-57280228" bind:__l="__l"></u-search><u-icon class="check-ball-park-btn data-v-57280228" vue-id="8dd740cc-4" name="map" size="50" data-event-opts="{{[['^click',[['goToBallParkMap']]]]}}" bind:click="__e" bind:__l="__l"></u-icon></view><scroll-view class="scroll-view moyi-te-a data-v-57280228" change:prop="{{cosmosMod.end}}" prop="{{cosmos.propValue}}" data-top="{{cosmos.scrollTop}}" id="cosmos-refresh-container" scroll-y="{{true}}" upper-threshold="50" bindtouchstart="{{cosmosMod.touchstart}}" bindtouchmove="{{cosmosMod.touchmove}}" bindtouchend="{{cosmosMod.touchend}}"><view class="load-text anim-text-lePeek text-center text-gray data-v-57280228" style="{{('height:'+base.CustomBar+'px')}}" id="load-text"><block wx:for="{{base.title}}" wx:for-item="item" wx:for-index="index" wx:key="index"><text class="anim-text data-v-57280228" style="{{('animation-delay:'+(200+index*100)+'ms;')}}">{{item}}</text></block></view><block wx:for="{{$root.l0}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['goToGameDetail',[index]]]]]}}" class="cosmos-chat text-grey data-v-57280228" bindtap="__e"><view class="flex margin-tb padding-lr-xls data-v-57280228"><view data-event-opts="{{[['tap',[['',['$event']],['userOpen',[index]]]]]}}" class="cu-avatar round lg data-v-57280228" style="{{('background-image:url('+item.$orig.avatar+');')}}" catchtap="__e"><image src="{{item.$orig.frame}}" mode="widthFix" class="data-v-57280228"></image></view><view class="margin-auto padding-lr-sm data-v-57280228"><text class="padding-right-sm  data-v-57280228">{{item.$orig.nickname}}</text><text class="{{['data-v-57280228','text-bold',item.$orig.gender==0?'text-pink  cuIcon-female':'text-blue  cuIcon-male']}}"></text></view><view class="flex-sub margin-auto data-v-57280228"></view><view class="flex cosmos-time data-v-57280228"><view class="text-grey  data-v-57280228">{{item.g0}}</view></view></view><view class="cu-item cosmos-text margin-bottom-sm data-v-57280228">{{item.$orig.text}}</view><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" class="padding-lr-xls data-v-57280228" catchtap="__e"><block wx:if="{{item.$orig.images}}"><view class="{{['data-v-57280228','grid','margin-auto',item.$orig.images_arr.length==1?'':'col-3 grid-square']}}"><block wx:for="{{item.$orig.images_arr}}" wx:for-item="items" wx:for-index="indexs" wx:key="indexs"><view data-event-opts="{{[['tap',[['previews',['$0',indexs],[[['cosmosList','',index,'images_arr']]]]]]]}}" class="margin-tb-sm cosmos-image-item data-v-57280228" bindtap="__e"><image class="cosmos-image-item-image data-v-57280228" lazy-load="{{true}}" src="{{items}}" mode="aspectFill"></image></view></block></view></block><block wx:if="{{item.$orig.videoUrl}}"><view class="{{['data-v-57280228','grid','margin-auto']}}"><view data-event-opts="{{[['tap',[['previews',['$0','$1'],[[['cosmosList','',index,'images_arr']],'indexs']]]]]}}" class="margin-tb-sm cosmos-image-item data-v-57280228" bindtap="__e"><video style="z-index:999;" id="{{'video'+index}}" src="{{item.$orig.videoUrl}}" controls="{{true}}" data-event-opts="{{[['error',[['videoErrorCallback',['$event']]]]]}}" binderror="__e" class="data-v-57280228"></video></view></view></block></view><view class="padding-lr-xls grid col-4 border-bottom text-center data-v-57280228"><view class="data-v-57280228"><text class="cuIcon-attention text-xl data-v-57280228"></text><text class="margin-left-ss data-v-57280228">{{item.$orig.views>0?item.$orig.views:''}}</text></view><view class="data-v-57280228"><text class="cuIcon-comment text-xl data-v-57280228"></text><text class="margin-left-ss data-v-57280228">{{item.$orig.reviews>0?item.$orig.reviews:''}}</text></view><view data-event-opts="{{[['tap',[['',['$event']],['like',[index]]]]]}}" catchtap="__e" class="data-v-57280228"><text class="{{['data-v-57280228',item.$orig.isLike?'cuIcon-likefill text-red':'cuIcon-like']}}"></text><text class="margin-left-ss data-v-57280228">{{item.$orig.likes>0?item.$orig.likes:''}}</text></view><view data-event-opts="{{[['tap',[['',['$event']]]]]}}" catchtap="__e" class="data-v-57280228"><text data-event-opts="{{[['tap',[['cosmosMoreOperate',[index]]]]]}}" class="cuIcon-more text-xl data-v-57280228" bindtap="__e"></text></view></view><view class="cosmos-border data-v-57280228"></view></view></block><view class="text-center text-white margin-auto data-v-57280228" id="more-text">加载中...</view></scroll-view><u-tabbar vue-id="8dd740cc-5" list="{{vuex_tabbar}}" mid-button="{{true}}" class="data-v-57280228" bind:__l="__l"></u-tabbar></view>